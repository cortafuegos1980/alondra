<!DOCTYPE html>
<html lang="es">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Reserva Entradas</title>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  /* Estilos Globales */
Â  Â  Â  Â  body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
Â  Â  Â  Â  .container { max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .form-group { margin-bottom: 15px; }
Â  Â  Â  Â  label { display: block; margin-bottom: 5px; font-weight: bold; }
Â  Â  Â  Â  input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
Â  Â  Â  Â  button { width: 100%; padding: 15px; background: #25D366; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; }
Â  Â  Â  Â  button.loading { background: #cccccc; cursor: not-allowed; }
Â  Â  Â  Â  .message { padding: 10px; border-radius: 5px; margin-bottom: 15px; display: none; }

Â  Â  Â  Â  /* Anti-spam */
Â  Â  Â  Â  .honeypot { display: none; visibility: hidden; height: 0; width: 0; position: absolute; left: -9999px; }

Â  Â  Â  Â  /* --- ESTILOS COMPACTOS FINALES (3 COLUMNAS UNIFORMES) --- */

Â  Â  Â  Â  /* Contenedor principal para organizar las 3 cajas lado a lado */
Â  Â  Â  Â  #contenedor-superior {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: stretch; /* Asegura que todas las cajas tengan la misma altura */
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Aplica a las cajas de Tiempo y Cupo */
Â  Â  Â  Â  .caja-estado-superior {
Â  Â  Â  Â  Â  Â  padding: 5px 10px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  background-color: #f9f9f9;Â 
Â  Â  Â  Â  Â  Â  margin: 5px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  flex-grow: 1;Â 
Â  Â  Â  Â  Â  Â  flex-basis: 0; /* Asegura la distribuciÃ³n equitativa de ancho */
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Estilo de la caja de Precio */
Â  Â  Â  Â  .precio-caja {
Â  Â  Â  Â  Â  Â  padding: 5px 10px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  background-color: #f9f9f9;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  color: #555;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  flex-basis: 0; /* Asegura la distribuciÃ³n equitativa de ancho */
Â  Â  Â  Â  Â  Â  margin: 5px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .precio-monto {
Â  Â  Â  Â  Â  Â  font-size: 1.2em;Â 
Â  Â  Â  Â  Â  Â  color: #000;Â 
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  margin-top: 3px;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Estilo para el texto dentro de la caja de estado */
Â  Â  Â  Â  .info-estado {
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin: 3px 0;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  .agotado-rojo {
Â  Â  Â  Â  Â  Â  color: #D32F2F;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â Â 
Â  Â  <div class="container">
Â  Â  Â  Â  <h2 id="tituloObra">Cargando Obra...</h2>

Â  Â  Â  Â  <div id="contenedor-superior">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="precioUnitario" class="precio-caja">Cargando valor...</div>Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="caja-cupo" class="caja-estado-superior">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="cupoDiv" class="info-estado">Cargando cupo...</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="caja-tiempo" class="caja-estado-superior">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="timerDiv" class="info-estado">â±ï¸ 05:00</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="message" class="message"></div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label>Apellido y Nombre:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="nombre" placeholder="Ej: MarÃ­a GonzÃ¡lez">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label>Tu WhatsApp (Sin 0 ni 15):</label>Â 
Â  Â  Â  Â  Â  Â  <input type="tel" id="telefono" placeholder="Ej: 3415123456" onkeypress="return isNumberKey(event)">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label>Cantidad:</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="cantidad" min="1" max="10" value="1">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label>Fecha del Evento:</label>
Â  Â  Â  Â  Â  Â  <select id="fecha">
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="form-group honeypot">
Â  Â  Â  Â  Â  Â  <label for="apellidoBot">No llenar este campo:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="apellidoBot" name="apellidoBot">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button id="btnReservar">Reservar</button>
Â  Â  </div>
Â  Â Â 
Â  Â  <script>
Â  Â  Â  Â  // *** 1. CONFIGURACIÃ“N CRUCIAL ***
Â  Â  Â  Â  // ğŸ’¡ 1. REVISA TU URL DE APPS SCRIPT. DEBE SER LA ÃšLTIMA DE TU DEPLOYMENT ACTIVO
Â  Â  Â  Â  const EXEC_URL = 'https://script.google.com/macros/s/AKfycbznmn09RZQb6o6-fh-VclrrE3Q2uRbxi-Nb3boBJN4qkAh8KZN9bH_sknGV30QmMubm/exec'; // Â¡REEMPLAZA ESTA URL!

Â  Â  Â  Â  // Filtro de la obra
Â  Â  Â  Â  const OBRA_FILTRO_NOMBRE = 'La Jirafa';Â 

Â  Â  Â  Â  // ğŸ’¡ 2. REVISA TU NÃšMERO DE GESTOR
Â  Â  Â  Â  const MANAGER_WHATSAPP_NUMBER = '5493492594940';Â 

Â  Â  Â  Â  let timerTimeout;Â 
Â  Â  Â  Â  let todosLosCupos = {};Â 

Â  Â  Â  Â  // -------------------------------------------------------------------------
Â  Â  Â  Â  // VALIDACIÃ“N ESTRICTA DE WHATSAPP (Solo nÃºmeros)
Â  Â  Â  Â  // -------------------------------------------------------------------------
Â  Â  Â  Â  function isNumberKey(evt) {
Â  Â  Â  Â  Â  Â  const charCode = (evt.which) ? evt.which : event.keyCode;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (charCode > 31 && (charCode < 48 || charCode > 57)) {
Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  }


Â  Â  Â  Â  /* FunciÃ³n para mostrar mensajes de estado */
Â  Â  Â  Â  function mostrarMensaje(texto, tipo = 'error') {
Â  Â  Â  Â  Â  Â  const messageDiv = document.getElementById('message');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!texto) {
Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  messageDiv.textContent = texto;
Â  Â  Â  Â  Â  Â  messageDiv.style.display = 'block';
Â  Â  Â  Â  Â  Â  messageDiv.className = 'message';Â 

Â  Â  Â  Â  Â  Â  if (tipo === 'exito') {
Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.style.backgroundColor = '#d4edda';Â 
Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.style.color = '#155724';Â 
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  }, 8000);Â 
Â  Â  Â  Â  Â  Â  } else if (tipo === 'error') {
Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.style.backgroundColor = '#f8d7da';
Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.style.color = '#721c24';
Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.style.fontWeight = 'bold';
Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.style.textTransform = 'uppercase';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* CARGAR NOMBRE DE OBRA (Ya no carga el precio) */
Â  Â  Â  Â  async function cargarNombreObra() {
Â  Â  Â  Â  Â  Â  const tituloObra = document.getElementById('tituloObra');
Â  Â  Â  Â  Â  Â  const precioDiv = document.getElementById('precioUnitario');Â 

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const url = EXEC_URL + '?accion=obtenerNombre&obra=' + encodeURIComponent(OBRA_FILTRO_NOMBRE);
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url);Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Error HTTP: ${response.status}`);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (data.status === 'OK' && data.nombre) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nuevoNombre = 'Reserva Entradas - ' + data.nombre;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.title = nuevoNombre;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tituloObra.textContent = nuevoNombre;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // El precio ya NO se carga aquÃ­, sino en actualizarPrecio()
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.title = 'Reserva de Entradas';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tituloObra.textContent = 'Reserva de Entradas';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (precioDiv) precioDiv.textContent = 'Obra no encontrada.';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch(err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error FATAL al cargar nombre de obra:', err);
Â  Â  Â  Â  Â  Â  Â  Â  if (precioDiv) precioDiv.textContent = 'Error al conectar.';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  // ğŸŒŸ NUEVA FUNCIÃ“N: ACTUALIZAR PRECIO
Â  Â  Â  Â  async function actualizarPrecio(idEvento) {
Â  Â  Â  Â  Â  Â  const precioDiv = document.getElementById('precioUnitario');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!idEvento) {
Â  Â  Â  Â  Â  Â  Â  Â  precioDiv.innerHTML = `<span style="font-size:0.9em; display:block;">VALOR</span><span class="precio-monto">$ -</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  precioDiv.innerHTML = 'Buscando valor...';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Llamamos al Apps Script con la nueva acciÃ³n y el ID del evento seleccionado
Â  Â  Â  Â  Â  Â  Â  Â  const url = EXEC_URL + '?accion=obtenerPrecioPorId&id=' + encodeURIComponent(idEvento);
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url); 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Error HTTP: ${response.status}`); 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (data.status === 'OK' && data.precio) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  precioDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size:0.9em; display:block;">VALOR</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="precio-monto">$${data.precio}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  precioDiv.innerHTML = 'Valor no encontrado.';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch(err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error al actualizar precio:', err);
Â  Â  Â  Â  Â  Â  Â  Â  precioDiv.innerHTML = 'Error de conexiÃ³n.';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* TEMPORIZADOR (Columna 3) */
Â  Â  Â  Â  function startTimer() {
Â  Â  Â  Â  Â  Â  let duration = 5 * 60; // 5 minutos
Â  Â  Â  Â  Â  Â  const timerDiv = document.getElementById('timerDiv');

Â  Â  Â  Â  Â  Â  function updateTimer() {
Â  Â  Â  Â  Â  Â  Â  Â  const minutes = parseInt(duration / 60, 10);
Â  Â  Â  Â  Â  Â  Â  Â  const seconds = parseInt(duration % 60, 10);

Â  Â  Â  Â  Â  Â  Â  Â  const displayMinutes = minutes < 10 ? "0" + minutes : minutes;
Â  Â  Â  Â  Â  Â  Â  Â  const displaySeconds = seconds < 10 ? "0" + seconds : seconds;

Â  Â  Â  Â  Â  Â  Â  Â  timerDiv.textContent = "â±ï¸ " + displayMinutes + ":" + displaySeconds;Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (--duration < 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(timerTimeout);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('btnReservar').disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timerDiv.textContent = "â±ï¸ 00:00";
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (timerTimeout) clearInterval(timerTimeout);Â 
Â  Â  Â  Â  Â  Â  timerTimeout = setInterval(updateTimer, 1000);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* CARGAR OPCIONES DEL EVENTO */
Â  Â  Â  Â  function cargarOpcionesEventos(opciones) {
Â  Â  Â  Â  Â  Â  const select = document.getElementById('fecha');
Â  Â  Â  Â  Â  Â  select.innerHTML = '';
Â  Â  Â  Â  Â  Â  const cupoDiv = document.getElementById('cupoDiv');
Â  Â  Â  Â  Â  Â  const precioDiv = document.getElementById('precioUnitario');

Â  Â  Â  Â  Â  Â  if (opciones.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  opt.textContent = "No hay eventos disponibles";
Â  Â  Â  Â  Â  Â  Â  Â  select.appendChild(opt);
Â  Â  Â  Â  Â  Â  Â  Â  cupoDiv.textContent = 'No hay eventos configurados.';
Â  Â  Â  Â  Â  Â  Â  Â  precioDiv.textContent = 'Valor no disponible.';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  opciones.forEach(opcion => {
Â  Â  Â  Â  Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  opt.value = opcion.id;

Â  Â  Â  Â  Â  Â  Â  Â  const cupo = todosLosCupos[opcion.id];

Â  Â  Â  Â  Â  Â  Â  Â  if (cupo === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.textContent = opcion.texto + " (Agotado)";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.style.color = "#b5b5b5";Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.textContent = opcion.texto;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.style.color = "black";
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  select.appendChild(opt);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  actualizarCupo();
Â  Â  Â  Â  }


Â  Â  Â  Â  /* ACTUALIZAR CUPO (Llamada al servidor) */
Â  Â  Â  Â  async function actualizarCupo() {
Â  Â  Â  Â  Â  Â  const cupoDiv = document.getElementById('cupoDiv');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  cupoDiv.textContent = 'Buscando...';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(EXEC_URL + '?accion=consultarCupo');Â 
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (data.status === 'OK' && data.cupos) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  todosLosCupos = data.cupos;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mostrarCupoSeleccionado();Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cupoDiv.textContent = 'Error al verificar cupo.';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch(err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error al consultar cupo:', err);
Â  Â  Â  Â  Â  Â  Â  Â  cupoDiv.textContent = 'Error de conexiÃ³n.';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* MOSTRAR CUPO SELECCIONADO (Columna 2) */
Â  Â  Â  Â  function mostrarCupoSeleccionado() {
Â  Â  Â  Â  Â  Â  const selectFecha = document.getElementById('fecha');
Â  Â  Â  Â  Â  Â  const idSeleccionado = selectFecha.value;
Â  Â  Â  Â  Â  Â  const cupoDiv = document.getElementById('cupoDiv');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // ğŸŒŸ CAMBIO CLAVE 1: Llama a la nueva funciÃ³n de precio aquÃ­
Â  Â  Â  Â  Â  Â  actualizarPrecio(idSeleccionado);

Â  Â  Â  Â  Â  Â  if (todosLosCupos.hasOwnProperty(idSeleccionado)) {
Â  Â  Â  Â  Â  Â  Â  Â  const cupoRestante = todosLosCupos[idSeleccionado];

Â  Â  Â  Â  Â  Â  Â  Â  if (cupoRestante === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cupoDiv.textContent = 'ğŸŸï¸ AGOTADO';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cupoDiv.classList.add('agotado-rojo');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // âœ… CLAVE: Texto corto (usando "disp.")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cupoDiv.textContent = `ğŸŸï¸ ${cupoRestante} disp.`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cupoDiv.classList.remove('agotado-rojo');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const opciones = selectFecha.options;
Â  Â  Â  Â  Â  Â  Â  Â  for (let opt of opciones) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cupo = todosLosCupos[opt.value];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (cupo === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.textContent = opt.textContent.split(" (")[0] + " (Agotado)";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.style.color = "#b5b5b5";Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.textContent = opt.textContent.split(" (")[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.style.color = "black";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  cupoDiv.textContent = 'Selecciona una funciÃ³n.';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* BOTON RESERVA */
Â  Â  Â  Â  document.getElementById('btnReservar').onclick = async function() {
Â  Â  Â  Â  Â  Â  mostrarMensaje('');Â 

Â  Â  Â  Â  Â  Â  const nombre = document.getElementById('nombre').value.trim();
Â  Â  Â  Â  Â  Â  // Limpia caracteres no numÃ©ricos
Â  Â  Â  Â  Â  Â  const telefonoCliente = document.getElementById('telefono').value.trim().replace(/\D/g,'');Â 
Â  Â  Â  Â  Â  Â  const cantidad = parseInt(document.getElementById('cantidad').value);
Â  Â  Â  Â  Â  Â  const fecha = document.getElementById('fecha').value;Â 

Â  Â  Â  Â  Â  Â  // âœ… VALIDACIÃ“N 1: Campos vacÃ­os
Â  Â  Â  Â  Â  Â  if (!nombre || !telefonoCliente || !cantidad || !fecha) {
Â  Â  Â  Â  Â  Â  Â  Â  mostrarMensaje('ğŸ’¡ Completa todos los campos.', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // âœ… VALIDACIÃ“N 2: Longitud del TelÃ©fono (MÃ­nimo 8 dÃ­gitos)
Â  Â  Â  Â  Â  Â  if (telefonoCliente.length < 8) {
Â  Â  Â  Â  Â  Â  Â  Â  mostrarMensaje('âŒ El nÃºmero de WhatsApp no parece ser vÃ¡lido. Debe tener al menos 8 dÃ­gitos.', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // VALIDACIÃ“N HONEYPOT (ANTI-SPAM)
Â  Â  Â  Â  Â  Â  const apellidoBot = document.getElementById('apellidoBot').value.trim();
Â  Â  Â  Â  Â  Â  if (apellidoBot.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  mostrarMensaje('âŒ Error de validaciÃ³n de formulario.', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const formData = new URLSearchParams();
Â  Â  Â  Â  Â  Â  formData.append('accion', 'reservar');
Â  Â  Â  Â  Â  Â  formData.append('nombre', nombre);
Â  Â  Â  Â  Â  Â  formData.append('telefono', telefonoCliente);
Â  Â  Â  Â  Â  Â  formData.append('cantidad', cantidad);
Â  Â  Â  Â  Â  Â  formData.append('fecha', fecha);Â 

Â  Â  Â  Â  Â  Â  this.disabled = true;
Â  Â  Â  Â  Â  Â  this.classList.add('loading');
Â  Â  Â  Â  Â  Â  clearInterval(timerTimeout);Â 

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(EXEC_URL, { method: 'POST', body: formData });Â 
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  if (data.status === 'OK') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mostrarMensaje(`âœ… Â¡RESERVA EXITOSA! ID: ${data.id}. Total: $${data.montoTotal}. Redirigiendo a WhatsApp...`, 'exito');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mensajeWhatsApp = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `Â¡Hola! Mi reserva es la ID: *${data.id}*.`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `Confirmo la reserva de *${cantidad}* entradas.`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `Mi telÃ©fono (Cliente) es: *${telefonoCliente}*`,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `El monto total es de *$${data.montoTotal}*.`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ``,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `â­ *LINK DE PAGO MERCADO PAGO:*`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `${data.linkPago}`,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ``,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `*IMPORTANTE:* Si el pago no se realiza en 5 minutos, la reserva puede cancelarse.`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ].join('\n');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mensajeURL = encodeURIComponent(mensajeWhatsApp);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.open(`https://wa.me/${MANAGER_WHATSAPP_NUMBER}?text=${mensajeURL}`, '_blank');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actualizarCupo();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mostrarMensaje('âŒ ' + data.message, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startTimer();Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  } catch(err) {
Â  Â  Â  Â  Â  Â  Â  Â  mostrarMensaje('âŒ Error de conexiÃ³n o red: ' + err.message, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  startTimer();Â 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  this.disabled = false;
Â  Â  Â  Â  Â  Â  this.classList.remove('loading');
Â  Â  Â  Â  };


Â  Â  Â  Â  document.getElementById('fecha').addEventListener('change', mostrarCupoSeleccionado);


Â  Â  Â  Â  // *** 4. INICIAR LAS FUNCIONES AL CARGAR ***
Â  Â  Â  Â  cargarNombreObra();Â 
Â  Â  Â  Â  startTimer();Â 
Â  Â  Â  Â  fetch(EXEC_URL + '?accion=obtenerOpciones&obra=' + encodeURIComponent(OBRA_FILTRO_NOMBRE))
Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  cargarOpcionesEventos(data);
Â  Â  Â  Â  Â  Â  Â  Â  // ğŸŒŸ CAMBIO CLAVE 2: Asegura que el precio inicial se cargue con la primera opciÃ³n.
Â  Â  Â  Â  Â  Â  Â  Â  const selectFecha = document.getElementById('fecha');
Â  Â  Â  Â  Â  Â  Â  Â  if (selectFecha.options.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actualizarPrecio(selectFecha.value);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error FATAL al cargar eventos (EXEC_URL incorrecta?):', err);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('cupoDiv').textContent = 'Error crÃ­tico al cargar eventos. Verifique la URL de Apps Script.';
Â  Â  Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
