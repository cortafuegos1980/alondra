<!DOCTYPE html>
<html lang="es">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Reserva Entradas</title>
ย ยย
ย ย <style>
ย ย ย ย /* Estilos Globales */
ย ย ย ย body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
ย ย ย ย .container { max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
ย ย ย ย .form-group { margin-bottom: 15px; }
ย ย ย ย label { display: block; margin-bottom: 5px; font-weight: bold; }
ย ย ย ย input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
ย ย ย ย button { width: 100%; padding: 15px; background: #25D366; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; }
ย ย ย ย button.loading { background: #cccccc; cursor: not-allowed; }
ย ย ย ย .message { padding: 10px; border-radius: 5px; margin-bottom: 15px; display: none; }

ย ย ย ย /* Anti-spam */
ย ย ย ย .honeypot { display: none; visibility: hidden; height: 0; width: 0; position: absolute; left: -9999px; }

ย ย ย ย /* --- ESTILOS COMPACTOS FINALES (3 COLUMNAS UNIFORMES) --- */

ย ย ย ย /* Contenedor principal para organizar las 3 cajas lado a lado */
ย ย ย ย #contenedor-superior {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: stretch; /* Asegura que todas las cajas tengan la misma altura */
ย ย ย ย ย ย flex-wrap: wrap;ย
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย }

ย ย ย ย /* Aplica a las cajas de Tiempo y Cupo */
ย ย ย ย .caja-estado-superior {
ย ย ย ย ย ย padding: 5px 10px;
ย ย ย ย ย ย border: 1px solid #ddd;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย background-color: #f9f9f9;ย
ย ย ย ย ย ย margin: 5px;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย flex-grow: 1;ย
ย ย ย ย ย ย flex-basis: 0; /* Asegura la distribuciรณn equitativa de ancho */
ย ย ย ย }

ย ย ย ย /* Estilo de la caja de Precio */
ย ย ย ย .precio-caja {
ย ย ย ย ย ย padding: 5px 10px;
ย ย ย ย ย ย border: 1px solid #ddd;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย background-color: #f9f9f9;ย
ย ย ย ย ย ย font-size: 0.9em;
ย ย ย ย ย ย color: #555;ย
ย ย ย ย ย ย font-weight: 600;ย
ย ย ย ย ย ย flex-grow: 1;
ย ย ย ย ย ย flex-basis: 0; /* Asegura la distribuciรณn equitativa de ancho */
ย ย ย ย ย ย margin: 5px;
ย ย ย ย ย ย text-align: center;
ย ย ย ย }

ย ย ย ย .precio-monto {
ย ย ย ย ย ย font-size: 1.2em;ย
ย ย ย ย ย ย color: #000;ย
ย ย ย ย ย ย display: block;
ย ย ย ย ย ย margin-top: 3px;ย
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย }

ย ย ย ย /* Estilo para el texto dentro de la caja de estado */
ย ย ย ย .info-estado {
ย ย ย ย ย ย font-size: 0.9em;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย margin: 3px 0;ย
ย ย ย ย }

ย ย ย ย .agotado-rojo {
ย ย ย ย ย ย color: #D32F2F;ย
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย }
ย ย </style>
</head>
<body>
ย ยย
ย ย <div class="container">
ย ย ย ย <h2 id="tituloObra">Cargando Obra...</h2>

ย ย ย ย <div id="contenedor-superior">
ย ย ย ย ย ยย
ย ย ย ย ย ย <div id="precioUnitario" class="precio-caja"></div>ย
ย ย ย ย ย ยย
ย ย ย ย ย ย <div id="caja-cupo" class="caja-estado-superior">
ย ย ย ย ย ย ย ย <div id="cupoDiv" class="info-estado">Cargando cupo...</div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div id="caja-tiempo" class="caja-estado-superior">
ย ย ย ย ย ย ย ย <div id="timerDiv" class="info-estado">โฑ๏ธ 05:00</div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย </div>
ย ย ย ย <div id="message" class="message"></div>
ย ย ย ยย
ย ย ย ย <div class="form-group">
ย ย ย ย ย ย <label>Apellido y Nombre:</label>
ย ย ย ย ย ย <input type="text" id="nombre" placeholder="Ej: Marรญa Gonzรกlez">
ย ย ย ย </div>

ย ย ย ย <div class="form-group">
ย ย ย ย ย ย <label>Tu WhatsApp (Sin 0 ni 15):</label>
ย ย ย ย ย ย <input type="tel" id="telefono" placeholder="Ej: 3415123456" onkeypress="return isNumberKey(event)">
ย ย ย ย </div>

ย ย ย ย <div class="form-group">
ย ย ย ย ย ย <label>Cantidad:</label>
ย ย ย ย ย ย <input type="number" id="cantidad" min="1" max="10" value="1">
ย ย ย ย </div>

ย ย ย ย <div class="form-group">
ย ย ย ย ย ย <label>Fecha del Evento:</label>
ย ย ย ย ย ย <select id="fecha">
ย ย ย ย ย ย </select>
ย ย ย ย </div>

ย ย ย ย <div class="form-group honeypot">
ย ย ย ย ย ย <label for="apellidoBot">No llenar este campo:</label>
ย ย ย ย ย ย <input type="text" id="apellidoBot" name="apellidoBot">
ย ย ย ย </div>

ย ย ย ย <button id="btnReservar">Reservar</button>
ย ย </div>
ย ยย
ย ย <script>
ย ย ย ย // *** 1. CONFIGURACIรN CRUCIAL ***
ย ย ย ย // ๐ก 1. REVISA TU URL DE APPS SCRIPT. DEBE SER LA รLTIMA DE TU DEPLOYMENT ACTIVO
ย ย ย ย const EXEC_URL = 'https://script.google.com/macros/s/AKfycbznmn09RZQb6o6-fh-VclrrE3Q2uRbxi-Nb3boBJN4qkAh8KZN9bH_sknGV30QmMubm/exec'; // ยกREEMPLAZA ESTA URL!

ย ย ย ย // Filtro de la obra
ย ย ย ย const OBRA_FILTRO_NOMBRE = 'La Jirafa';ย

ย ย ย ย // ๐ก 2. REVISA TU NรMERO DE GESTOR
ย ย ย ย const MANAGER_WHATSAPP_NUMBER = '5493492594940';ย

ย ย ย ย let timerTimeout;ย
ย ย ย ย let todosLosCupos = {};ย

ย ย ย ย // -------------------------------------------------------------------------
ย ย ย ย // VALIDACIรN ESTRICTA DE WHATSAPP (Solo nรบmeros)
ย ย ย ย // -------------------------------------------------------------------------
ย ย ย ย function isNumberKey(evt) {
ย ย ย ย ย ย const charCode = (evt.which) ? evt.which : event.keyCode;
ย ย ย ย ย ยย
ย ย ย ย ย ย if (charCode > 31 && (charCode < 48 || charCode > 57)) {
ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย }
ย ย ย ย ย ย return true;
ย ย ย ย }


ย ย ย ย /* Funciรณn para mostrar mensajes de estado */
ย ย ย ย function mostrarMensaje(texto, tipo = 'error') {
ย ย ย ย ย ย const messageDiv = document.getElementById('message');
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!texto) {
ย ย ย ย ย ย ย ย messageDiv.style.display = 'none';
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย messageDiv.textContent = texto;
ย ย ย ย ย ย messageDiv.style.display = 'block';
ย ย ย ย ย ย messageDiv.className = 'message';ย

ย ย ย ย ย ย if (tipo === 'exito') {
ย ย ย ย ย ย ย ย messageDiv.style.backgroundColor = '#d4edda';ย
ย ย ย ย ย ย ย ย messageDiv.style.color = '#155724';ย
ย ย ย ย ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย ย ย ย ย messageDiv.style.display = 'none';
ย ย ย ย ย ย ย ย }, 8000);ย
ย ย ย ย ย ย } else if (tipo === 'error') {
ย ย ย ย ย ย ย ย messageDiv.style.backgroundColor = '#f8d7da';
ย ย ย ย ย ย ย ย messageDiv.style.color = '#721c24';
ย ย ย ย ย ย ย ย messageDiv.style.fontWeight = 'bold';
ย ย ย ย ย ย ย ย messageDiv.style.textTransform = 'uppercase';
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย /* CARGAR NOMBRE DE OBRA (SIN PRECIO INICIAL) */
ย ย ย ย async function cargarNombreObra() {
ย ย ย ย ย ย const tituloObra = document.getElementById('tituloObra');
ย ย ย ย ย ย const precioDiv = document.getElementById('precioUnitario');

ย ย ย ย ย ย // Inicializamos el precio (se actualizarรก con el primer evento)
ย ย ย ย ย ย if (precioDiv) {
ย ย ย ย ย ย ย ย precioDiv.innerHTML = '<span style="font-size:0.9em; display:block;">VALOR</span> <span class="precio-monto">Cargando...</span>';
ย ย ย ย ย ย }

ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Obtenemos solo el nombre (ya no el precio general de la obra)
ย ย ย ย ย ย ย ย const url = EXEC_URL + '?accion=obtenerNombre&obra=' + encodeURIComponent(OBRA_FILTRO_NOMBRE);
ย ย ย ย ย ย ย ย const response = await fetch(url);ย
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (!response.ok) {ย
ย ย ย ย ย ย ย ย ย ย throw new Error(`Error HTTP: ${response.status}`);ย
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const data = await response.json();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (data.status === 'OK' && data.nombre) {
ย ย ย ย ย ย ย ย ย ย const nuevoNombre = 'Reserva Entradas - ' + data.nombre;
ย ย ย ย ย ย ย ย ย ย document.title = nuevoNombre;
ย ย ย ย ย ย ย ย ย ย tituloObra.textContent = nuevoNombre;
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย document.title = 'Reserva de Entradas';
ย ย ย ย ย ย ย ย ย ย tituloObra.textContent = 'Reserva de Entradas';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch(err) {
ย ย ย ย ย ย ย ย console.error('Error FATAL al cargar nombre de obra:', err);
ย ย ย ย ย ย ย ย if (precioDiv) precioDiv.innerHTML = '<span style="font-size:0.9em; display:block;">VALOR</span> <span class="precio-monto">Error</span>';
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย /* TEMPORIZADOR (Columna 3) */
ย ย ย ย function startTimer() {
ย ย ย ย ย ย let duration = 5 * 60; // 5 minutos
ย ย ย ย ย ย const timerDiv = document.getElementById('timerDiv');

ย ย ย ย ย ย function updateTimer() {
ย ย ย ย ย ย ย ย const minutes = parseInt(duration / 60, 10);
ย ย ย ย ย ย ย ย const seconds = parseInt(duration % 60, 10);

ย ย ย ย ย ย ย ย const displayMinutes = minutes < 10 ? "0" + minutes : minutes;
ย ย ย ย ย ย ย ย const displaySeconds = seconds < 10 ? "0" + seconds : seconds;

ย ย ย ย ย ย ย ย timerDiv.textContent = "โฑ๏ธ " + displayMinutes + ":" + displaySeconds;ย

ย ย ย ย ย ย ย ย if (--duration < 0) {
ย ย ย ย ย ย ย ย ย ย clearInterval(timerTimeout);ย
ย ย ย ย ย ย ย ย ย ย document.getElementById('btnReservar').disabled = true;
ย ย ย ย ย ย ย ย ย ย timerDiv.textContent = "โฑ๏ธ 00:00";
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย if (timerTimeout) clearInterval(timerTimeout);ย
ย ย ย ย ย ย timerTimeout = setInterval(updateTimer, 1000);
ย ย ย ย }

ย ย ย ย /* CARGAR OPCIONES DEL EVENTO */
ย ย ย ย function cargarOpcionesEventos(opciones) {
ย ย ย ย ย ย const select = document.getElementById('fecha');
ย ย ย ย ย ย select.innerHTML = '';
ย ย ย ย ย ย const cupoDiv = document.getElementById('cupoDiv');

ย ย ย ย ย ย if (opciones.length === 0) {
ย ย ย ย ย ย ย ย const opt = document.createElement('option');
ย ย ย ย ย ย ย ย opt.textContent = "No hay eventos disponibles";
ย ย ย ย ย ย ย ย select.appendChild(opt);
ย ย ย ย ย ย ย ย cupoDiv.textContent = 'No hay eventos configurados.';
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย opciones.forEach(opcion => {
ย ย ย ย ย ย ย ย const opt = document.createElement('option');
ย ย ย ย ย ย ย ย opt.value = opcion.id;

ย ย ย ย ย ย ย ย const cupo = todosLosCupos[opcion.id];

ย ย ย ย ย ย ย ย if (cupo === 0) {
ย ย ย ย ย ย ย ย ย ย opt.textContent = opcion.texto + " (Agotado)";
ย ย ย ย ย ย ย ย ย ย opt.style.color = "#b5b5b5";ย
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย opt.textContent = opcion.texto;
ย ย ย ย ย ย ย ย ย ย opt.style.color = "black";
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย select.appendChild(opt);
ย ย ย ย ย ย });

ย ย ย ย ย ย // CLAVE: Llamamos a actualizar cupo/precio aquรญ
ย ย ย ย ย ย actualizarCupo().then(() => {
ย ย ย ย ย ย ย ย mostrarCupoSeleccionado();
ย ย ย ย ย ย });
ย ย ย ย }


ย ย ย ย /* ACTUALIZAR CUPO (Llamada al servidor) */
ย ย ย ย async function actualizarCupo() {
ย ย ย ย ย ย const cupoDiv = document.getElementById('cupoDiv');
ย ย ย ย ย ยย
ย ย ย ย ย ย // cupoDiv.textContent = 'Buscando...'; // Lo movemos a mostrarCupoSeleccionado para evitar parpadeo
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const response = await fetch(EXEC_URL + '?accion=consultarCupo');ย
ย ย ย ย ย ย ย ย const data = await response.json();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (data.status === 'OK' && data.cupos) {
ย ย ย ย ย ย ย ย ย ย todosLosCupos = data.cupos;ย
ย ย ย ย ย ย ย ย ย ย // mostrarCupoSeleccionado(); // Ya no se llama aquรญ
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย cupoDiv.textContent = 'Error al verificar cupo.';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch(err) {
ย ย ย ย ย ย ย ย console.error('Error al consultar cupo:', err);
ย ย ย ย ย ย ย ย cupoDiv.textContent = 'Error de conexiรณn.';
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย /* MOSTRAR CUPO Y PRECIO SELECCIONADO (Columna 2 y 1) */
ย ย ย ย async function mostrarCupoSeleccionado() { 
ย ย ย ย ย ย const selectFecha = document.getElementById('fecha');
ย ย ย ย ย ย const idSeleccionado = selectFecha.value;
ย ย ย ย ย ย const cupoDiv = document.getElementById('cupoDiv');
ย ย ย ย ย ย const precioDiv = document.getElementById('precioUnitario'); 

ย ย ย ย ย ย if (todosLosCupos.hasOwnProperty(idSeleccionado)) {
ย ย ย ย ย ย ย ย // 1. Actualizar Cupo
ย ย ย ย ย ย ย ย const cupoRestante = todosLosCupos[idSeleccionado];

ย ย ย ย ย ย ย ย if (cupoRestante === 0) {
ย ย ย ย ย ย ย ย ย ย cupoDiv.textContent = '๐๏ธ AGOTADO';
ย ย ย ย ย ย ย ย ย ย cupoDiv.classList.add('agotado-rojo');
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย cupoDiv.textContent = `๐๏ธ ${cupoRestante} disp.`;
ย ย ย ย ย ย ย ย ย ย cupoDiv.classList.remove('agotado-rojo');
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย // Opciones del select: (Actualizaciรณn de agotado)
ย ย ย ย ย ย ย ย const opciones = selectFecha.options;
ย ย ย ย ย ย ย ย for (let opt of opciones) {
ย ย ย ย ย ย ย ย ย ย const cupo = todosLosCupos[opt.value];

ย ย ย ย ย ย ย ย ย ย if (cupo === 0) {
ย ย ย ย ย ย ย ย ย ย ย ย opt.textContent = opt.textContent.split(" (")[0] + " (Agotado)";
ย ย ย ย ย ย ย ย ย ย ย ย opt.style.color = "#b5b5b5";ย
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย opt.textContent = opt.textContent.split(" (")[0];
ย ย ย ย ย ย ย ย ย ย ย ย opt.style.color = "black";
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย // 2. Actualizar Precio Especรญfico del Evento
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย precioDiv.innerHTML = '<span style="font-size:0.9em; display:block;">VALOR</span> <span class="precio-monto">...</span>';
ย ย ย ย ย ย ย ย ย ย const url = EXEC_URL + '?accion=obtenerPrecio&idEvento=' + encodeURIComponent(idSeleccionado);
ย ย ย ย ย ย ย ย ย ย const response = await fetch(url);
ย ย ย ย ย ย ย ย ย ย const data = await response.json();

ย ย ย ย ย ย ย ย ย ย if (data.status === 'OK' && data.precio) {
ย ย ย ย ย ย ย ย ย ย ย ย precioDiv.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span style="font-size:0.9em; display:block;">VALOR</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="precio-monto">$${data.precio}</span>
ย ย ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย precioDiv.innerHTML = '<span style="font-size:0.9em; display:block;">VALOR</span> <span class="precio-monto">N/A</span>';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('Error al actualizar precio:', error);
ย ย ย ย ย ย ย ย ย ย precioDiv.innerHTML = '<span style="font-size:0.9em; display:block;">VALOR</span> <span class="precio-monto">Error</span>';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย cupoDiv.textContent = 'Selecciona una funciรณn.';
ย ย ย ย ย ย ย ย precioDiv.innerHTML = '<span style="font-size:0.9em; display:block;">VALOR</span> <span class="precio-monto">...</span>';
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย /* BOTON RESERVA */
ย ย ย ย document.getElementById('btnReservar').onclick = async function() {
ย ย ย ย ย ย mostrarMensaje('');ย

ย ย ย ย ย ย const nombre = document.getElementById('nombre').value.trim();
ย ย ย ย ย ย const telefonoCliente = document.getElementById('telefono').value.trim().replace(/\D/g,'');ย
ย ย ย ย ย ย const cantidad = parseInt(document.getElementById('cantidad').value);
ย ย ย ย ย ย const fecha = document.getElementById('fecha').value;ย

ย ย ย ย ย ย if (!nombre || !telefonoCliente || !cantidad || !fecha) {
ย ย ย ย ย ย ย ย mostrarMensaje('๐ก Completa todos los campos.', 'error');
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย // VALIDACIรN HONEYPOT (ANTI-SPAM)
ย ย ย ย ย ย const apellidoBot = document.getElementById('apellidoBot').value.trim();
ย ย ย ย ย ย if (apellidoBot.length > 0) {
ย ย ย ย ย ย ย ย mostrarMensaje('โ Error de validaciรณn de formulario.', 'error');
ย ย ย ย ย ย ย ย return;ย
ย ย ย ย ย ย }

ย ย ย ย ย ย const formData = new URLSearchParams();
ย ย ย ย ย ย formData.append('accion', 'reservar');
ย ย ย ย ย ย formData.append('nombre', nombre);
ย ย ย ย ย ย formData.append('telefono', telefonoCliente);
ย ย ย ย ย ย formData.append('cantidad', cantidad);
ย ย ย ย ย ย formData.append('fecha', fecha);ย

ย ย ย ย ย ย this.disabled = true;
ย ย ย ย ย ย this.classList.add('loading');
ย ย ย ย ย ย clearInterval(timerTimeout);ย

ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const response = await fetch(EXEC_URL, { method: 'POST', body: formData });ย
ย ย ย ย ย ย ย ย const data = await response.json();

ย ย ย ย ย ย ย ย if (data.status === 'OK') {
ย ย ย ย ย ย ย ย ย ย mostrarMensaje(`โ ยกRESERVA EXITOSA! ID: ${data.id}. Total: $${data.montoTotal}. Redirigiendo a WhatsApp...`, 'exito');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const mensajeWhatsApp = [
ย ย ย ย ย ย ย ย ย ย ย ย `ยกHola! Mi reserva es la ID: *${data.id}*.`,
ย ย ย ย ย ย ย ย ย ย ย ย `Confirmo la reserva de *${cantidad}* entradas.`,
ย ย ย ย ย ย ย ย ย ย ย ย `Mi telรฉfono (Cliente) es: *${telefonoCliente}*`,ย
ย ย ย ย ย ย ย ย ย ย ย ย `El monto total es de *$${data.montoTotal}*.`,
ย ย ย ย ย ย ย ย ย ย ย ย ``,
ย ย ย ย ย ย ย ย ย ย ย ย `โญ *LINK DE PAGO MERCADO PAGO:*`,
ย ย ย ย ย ย ย ย ย ย ย ย `${data.linkPago}`,ย
ย ย ย ย ย ย ย ย ย ย ย ย ``,
ย ย ย ย ย ย ย ย ย ย ย ย `*IMPORTANTE:* Si el pago no se realiza en 5 minutos, la reserva puede cancelarse.`
ย ย ย ย ย ย ย ย ย ย ].join('\n');ย

ย ย ย ย ย ย ย ย ย ย const mensajeURL = encodeURIComponent(mensajeWhatsApp);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย window.open(`https://wa.me/${MANAGER_WHATSAPP_NUMBER}?text=${mensajeURL}`, '_blank');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย actualizarCupo();
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย mostrarMensaje('โ ' + data.message, 'error');
ย ย ย ย ย ย ย ย ย ย startTimer();ย
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย } catch(err) {
ย ย ย ย ย ย ย ย mostrarMensaje('โ Error de conexiรณn o red: ' + err.message, 'error');
ย ย ย ย ย ย ย ย startTimer();ย
ย ย ย ย ย ย }

ย ย ย ย ย ย this.disabled = false;
ย ย ย ย ย ย this.classList.remove('loading');
ย ย ย ย };


ย ย ย ย document.getElementById('fecha').addEventListener('change', mostrarCupoSeleccionado);


ย ย ย ย // *** 4. INICIAR LAS FUNCIONES AL CARGAR ***
ย ย ย ย cargarNombreObra();ย
ย ย ย ย startTimer();ย
ย ย ย ย fetch(EXEC_URL + '?accion=obtenerOpciones&obra=' + encodeURIComponent(OBRA_FILTRO_NOMBRE))
ย ย ย ย ย ย .then(response => response.json())
ย ย ย ย ย ย .then(data => cargarOpcionesEventos(data))
ย ย ย ย ย ย .catch(err => {
ย ย ย ย ย ย ย ย console.error('Error FATAL al cargar eventos (EXEC_URL incorrecta?):', err);
ย ย ย ย ย ย ย ย document.getElementById('cupoDiv').textContent = 'Error crรญtico al cargar eventos. Verifique la URL de Apps Script.';
ย ย ย ย ย ย });
ย ย </script>
</body>
</html>
